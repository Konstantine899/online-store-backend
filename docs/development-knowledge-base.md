# –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ - online-store-backend

## üéØ Sequelize + NestJS Best Practices

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è Sequelize –º–æ–¥–µ–ª–µ–π

**–í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö:**
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
return this.createResponse(user.get({ plain: true }));

// ‚ùå –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ - –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å unicode
return this.createResponse(user.toJSON());
```

**–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö:**
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ returning
const [affectedRows] = await this.userModel.update(updates, {
    where: { id: userId },
});
return affectedRows > 0 ? this.userModel.findByPk(userId) : null;

// ‚ùå –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ - returning: true –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å MySQL
const [affectedRows] = await this.userModel.update(updates, {
    where: { id: userId },
    returning: true  // –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å MySQL!
});
```

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –≤ NestJS

```typescript
@Roles(...USER_ROLES)           // 1. –†–æ–ª–∏
@UserGuards()                   // 2. –ì–≤–∞—Ä–¥—ã
@UpdateUserSwaggerDecorator()   // 3. Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
@Patch('profile/preferences')   // 4. HTTP –º–µ—Ç–æ–¥
@HttpCode(HttpStatus.OK)        // 5. –°—Ç–∞—Ç—É—Å –∫–æ–¥
async updatePreferences() {
    // –ª–æ–≥–∏–∫–∞ –º–µ—Ç–æ–¥–∞
}
```

## üêõ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: 404 –æ—à–∏–±–∫–∏ –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö

**–°–∏–º–ø—Ç–æ–º—ã:**
- –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç —Å `expected 200 "OK", got 404 "Not Found"`
- –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ, —á—Ç–æ –º–µ—Ç–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- SQL –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è Sequelize –º–æ–¥–µ–ª–µ–π
2. Unicode —Å–∏–º–≤–æ–ª—ã (—ç–º–æ–¥–∑–∏) –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤

**–†–µ—à–µ–Ω–∏—è:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user.get({ plain: true })` –≤–º–µ—Å—Ç–æ `user.toJSON()`
2. –ò–∑–±–µ–≥–∞—Ç—å unicode —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–Ω–≤–µ–Ω—Ü–∏—è–º –ø—Ä–æ–µ–∫—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞: Sequelize returning: true –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- `returning: true` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å
- –ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –¥–µ–ª–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π `findByPk()` –∑–∞–ø—Ä–æ—Å

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±—Ä–∞—Ç—å `returning: true` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `findByPk()` –ø–æ—Å–ª–µ `update()`

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ Best practices –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

**–ò–∑–±–µ–≥–∞–π—Ç–µ unicode —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
```typescript
// ‚ùå –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ
notificationPreferences: {
    'unicode': '—Ç–µ—Å—Ç üöÄ',  // –≠–º–æ–¥–∑–∏ –≤—ã–∑—ã–≤–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã
    'special-chars': 'test@#$%^&*()',
}

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
notificationPreferences: {
    'special-chars': 'test@#$%^&*()',
    'spaces and symbols': 'value with spaces'
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤:**
- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--runInBand` –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏–∑–æ–ª—è—Ü–∏—é —Ç–µ—Å—Ç–æ–≤

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
- –¢–æ–Ω–∫–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã - —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç/–≤–∞–ª–∏–¥–∞—Ü–∏—è/–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è Sequelize –æ—à–∏–±–æ–∫
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å correlation ID

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
npm test -- --testPathPattern="user-preferences.integration.test.ts"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å –∏–º–µ–Ω–µ–º
npm test -- --testNamePattern="special characters in preferences"

# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
npm test -- --runInBand
```

### –û—Ç–ª–∞–¥–∫–∞
```bash
# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
npm run build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–∞
npm run lint

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
npm run type-check
```

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Sequelize –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `attributes` –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π
- –ò–∑–±–µ–≥–∞–π—Ç–µ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é `include`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è —Å–ø–∏—Å–∫–æ–≤

### NestJS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ `Promise.all`
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ payload —Ä–∞–∑–º–µ—Ä–æ–≤

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-05
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** online-store-backend v1.0
