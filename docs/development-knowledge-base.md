# –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ - online-store-backend

## üìã –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

### üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- [404 –æ—à–∏–±–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö](#–ø—Ä–æ–±–ª–µ–º–∞-404-–æ—à–∏–±–∫–∏-–≤-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö-—Ç–µ—Å—Ç–∞—Ö)
- [Sequelize returning –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç](#–ø—Ä–æ–±–ª–µ–º–∞-sequelize-returning-true-–Ω–µ-—Ä–∞–±–æ—Ç–∞–µ—Ç)
- [Unicode —Å–∏–º–≤–æ–ª—ã –≤ —Ç–µ—Å—Ç–∞—Ö](#best-practices-–¥–ª—è-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö-—Ç–µ—Å—Ç–æ–≤)
- [Rate limiting –≤ —Ç–µ—Å—Ç–∞—Ö](#–ø—Ä–æ–±–ª–µ–º–∞-rate-limiting-–≤-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö-—Ç–µ—Å—Ç–∞—Ö)

### ‚úÖ Best Practices
- [Sequelize —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è](#–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è-—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è-sequelize-–º–æ–¥–µ–ª–µ–π)
- [–ü–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤](#–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π-–ø–æ—Ä—è–¥–æ–∫-–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤-–≤-nestjs)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#best-practices-–¥–ª—è-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö-—Ç–µ—Å—Ç–æ–≤)
- [Rate limiting –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#rate-limiting-–∏-bruteforceguard)

### üîß –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#–ø–æ–ª–µ–∑–Ω—ã–µ-–∫–æ–º–∞–Ω–¥—ã)
- [–û—Ç–ª–∞–¥–∫–∞](#–ø–æ–ª–µ–∑–Ω—ã–µ-–∫–æ–º–∞–Ω–¥—ã)
- [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å](#–ø–æ–ª–µ–∑–Ω—ã–µ-–∫–æ–º–∞–Ω–¥—ã)

---

## üéØ Sequelize + NestJS Best Practices

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è Sequelize –º–æ–¥–µ–ª–µ–π

**–í –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö:**
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö
return this.createResponse(user.get({ plain: true }));

// ‚ùå –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ - –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ —Å unicode
return this.createResponse(user.toJSON());
```

**–ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö:**
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑ returning
const [affectedRows] = await this.userModel.update(updates, {
    where: { id: userId },
});
return affectedRows > 0 ? this.userModel.findByPk(userId) : null;

// ‚ùå –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ - returning: true –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å MySQL
const [affectedRows] = await this.userModel.update(updates, {
    where: { id: userId },
    returning: true  // –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å MySQL!
});
```

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –≤ NestJS

```typescript
@Roles(...USER_ROLES)           // 1. –†–æ–ª–∏
@UserGuards()                   // 2. –ì–≤–∞—Ä–¥—ã
@UpdateUserSwaggerDecorator()   // 3. Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
@Patch('profile/preferences')   // 4. HTTP –º–µ—Ç–æ–¥
@HttpCode(HttpStatus.OK)        // 5. –°—Ç–∞—Ç—É—Å –∫–æ–¥
async updatePreferences() {
    // –ª–æ–≥–∏–∫–∞ –º–µ—Ç–æ–¥–∞
}
```

## üêõ –†–µ—à–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: 404 –æ—à–∏–±–∫–∏ –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö

**–°–∏–º–ø—Ç–æ–º—ã:**
- –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç —Å `expected 200 "OK", got 404 "Not Found"`
- –í –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ, —á—Ç–æ –º–µ—Ç–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- SQL –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è Sequelize –º–æ–¥–µ–ª–µ–π
2. Unicode —Å–∏–º–≤–æ–ª—ã (—ç–º–æ–¥–∑–∏) –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤

**–†–µ—à–µ–Ω–∏—è:**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `user.get({ plain: true })` –≤–º–µ—Å—Ç–æ `user.toJSON()`
2. –ò–∑–±–µ–≥–∞—Ç—å unicode —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ–Ω–≤–µ–Ω—Ü–∏—è–º –ø—Ä–æ–µ–∫—Ç–∞

### –ü—Ä–æ–±–ª–µ–º–∞: Sequelize returning: true –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–°–∏–º–ø—Ç–æ–º—ã:**
- `returning: true` –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∑–∞–ø–∏—Å—å
- –ü—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –¥–µ–ª–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π `findByPk()` –∑–∞–ø—Ä–æ—Å

**–†–µ—à–µ–Ω–∏–µ:**
- –£–±—Ä–∞—Ç—å `returning: true` –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `findByPk()` –ø–æ—Å–ª–µ `update()`

### –ü—Ä–æ–±–ª–µ–º–∞: Rate limiting –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö

**–°–∏–º–ø—Ç–æ–º—ã:**
- –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç —Å `Unexpected 429 on first attempt`
- BruteforceGuard –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- –ì–ª–æ–±–∞–ª—å–Ω—ã–π rate limiter –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ç–µ—Å—Ç—ã

**–ü—Ä–∏—á–∏–Ω—ã:**
1. BruteforceGuard –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –æ—Ç ThrottlerGuard –∏ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
2. –ì–ª–æ–±–∞–ª—å–Ω—ã–π rate limiter –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏—è:**
1. **–ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤:**
```typescript
// –í BruteforceGuard
if ((request as any).__bruteforceProcessed) {
    return true;
}
(request as any).__bruteforceProcessed = true;
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –î–û —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```typescript
beforeAll(async () => {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –î–û —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    process.env.RATE_LIMIT_ENABLED = 'true';
    process.env.RATE_LIMIT_LOGIN_ATTEMPTS = '2';
    // ... –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    
    app = await setupTestAppWithRateLimit();
});
```

3. **–°–±—Ä–æ—Å —Å—á—ë—Ç—á–∏–∫–æ–≤ –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏:**
```typescript
beforeEach(async () => {
    BruteforceGuard.resetCounters();
});
```

4. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ setupTestAppWithRateLimit –≤–º–µ—Å—Ç–æ setupTestApp:**
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –Ω–µ –º–æ–∫–∏—Ä—É–µ—Ç BruteforceGuard
app = await setupTestAppWithRateLimit();

// ‚ùå –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ - –º–æ–∫–∏—Ä—É–µ—Ç BruteforceGuard
app = await setupTestApp();
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### ‚úÖ Best practices –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤

**–ò–∑–±–µ–≥–∞–π—Ç–µ unicode —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**
```typescript
// ‚ùå –ü—Ä–æ–±–ª–µ–º–∞—Ç–∏—á–Ω–æ
notificationPreferences: {
    'unicode': '—Ç–µ—Å—Ç üöÄ',  // –≠–º–æ–¥–∑–∏ –≤—ã–∑—ã–≤–∞—é—Ç –ø—Ä–æ–±–ª–µ–º—ã
    'special-chars': 'test@#$%^&*()',
}

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
notificationPreferences: {
    'special-chars': 'test@#$%^&*()',
    'spaces and symbols': 'value with spaces'
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤:**
- –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--runInBand` –¥–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏–∑–æ–ª—è—Ü–∏—é —Ç–µ—Å—Ç–æ–≤

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
- –¢–æ–Ω–∫–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã - —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç/–≤–∞–ª–∏–¥–∞—Ü–∏—è/–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
- –í—Å—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ —Å–µ—Ä–≤–∏—Å–∞—Ö
- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è Sequelize –æ—à–∏–±–æ–∫
- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å correlation ID

## üõ°Ô∏è Rate Limiting –∏ BruteforceGuard

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è BruteforceGuard

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ guard:**
```typescript
@Injectable()
export class BruteforceGuard extends ThrottlerGuard {
    private static counters = new Map<string, { count: number; resetAt: number }>();
    
    // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
    protected async handleRequest(requestProps: ThrottlerRequest): Promise<boolean> {
        const request = requestProps.context.switchToHttp().getRequest<Request>();
        
        if ((request as any).__bruteforceProcessed) {
            return true;
        }
        (request as any).__bruteforceProcessed = true;
        
        // –õ–æ–≥–∏–∫–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö endpoints
        if (request.url.includes('/auth/login')) {
            return this.handleLoginAttempt(requestProps);
        }
        // ... –¥—Ä—É–≥–∏–µ endpoints
    }
}
```

**–ü—Ä–æ—Ñ–∏–ª–∏ rate limiting:**
- **Login**: 5 –ø–æ–ø—ã—Ç–æ–∫ –∑–∞ 15 –º–∏–Ω—É—Ç
- **Refresh**: 10 –ø–æ–ø—ã—Ç–æ–∫ –∑–∞ 5 –º–∏–Ω—É—Ç  
- **Registration**: 3 –ø–æ–ø—ã—Ç–∫–∏ –∑–∞ –º–∏–Ω—É—Ç—É

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ PII:**
```typescript
this.logger.warn(`${profile} rate limit exceeded`, {
    route: request.url,
    method: request.method,
    correlationId: request.headers['x-request-id'],
    // –ù–ï –ª–æ–≥–∏—Ä—É–µ–º IP, email, –ø–∞—Ä–æ–ª–∏
});
```

### ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π rate limiter

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ main.ts:**
```typescript
if (cfg.RATE_LIMIT_ENABLED) {
    const perIpCounters = new Map<string, { s: number; sTs: number; m: number; mTs: number }>();
    
    app.use((req: Request, res: Response, next: NextFunction) => {
        const ip = (req.headers['x-forwarded-for'] as string) || req.socket.remoteAddress || 'unknown';
        // –õ–æ–≥–∏–∫–∞ —Å—á—ë—Ç—á–∏–∫–æ–≤ 3 rps / 100 rpm
    });
}
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- 3 –∑–∞–ø—Ä–æ—Å–∞ –≤ —Å–µ–∫—É–Ω–¥—É
- 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É
- –û—Ç–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `RATE_LIMIT_ENABLED=false`

### ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ rate limiting

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–µ—Å—Ç–æ–≤:**
```typescript
beforeAll(async () => {
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –î–û —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    process.env.NODE_ENV = 'test';
    process.env.RATE_LIMIT_ENABLED = 'true';
    process.env.RATE_LIMIT_LOGIN_ATTEMPTS = '2';
    
    app = await setupTestAppWithRateLimit(); // –ù–ï setupTestApp!
});

beforeEach(async () => {
    BruteforceGuard.resetCounters(); // –°–±—Ä–æ—Å –º–µ–∂–¥—É —Ç–µ—Å—Ç–∞–º–∏
});
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:**
```typescript
it('should return 429 after exceeding attempts', async () => {
    // –ü–µ—Ä–≤–∞—è –ø–æ–ø—ã—Ç–∫–∞ - –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏ (400/401)
    const res1 = await request(server).post('/auth/login').send(data);
    expect(res1.status).not.toBe(429);
    
    // –í—Ç–æ—Ä–∞—è –ø–æ–ø—ã—Ç–∫–∞ - –¥–æ–ª–∂–Ω–∞ –ø—Ä–æ–π—Ç–∏ (400/401)
    const res2 = await request(server).post('/auth/login').send(data);
    expect(res2.status).not.toBe(429);
    
    // –¢—Ä–µ—Ç—å—è –ø–æ–ø—ã—Ç–∫–∞ - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (429)
    const res3 = await request(server).post('/auth/login').send(data);
    expect(res3.status).toBe(429);
});
```

## üìù –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞
npm test -- --testPathPattern="user-preferences.integration.test.ts"

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —Å –∏–º–µ–Ω–µ–º
npm test -- --testNamePattern="special characters in preferences"

# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
npm test -- --runInBand
```

### –û—Ç–ª–∞–¥–∫–∞
```bash
# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
npm run build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–∞
npm run lint

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
npm run type-check
```

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Sequelize –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `attributes` –¥–ª—è –≤—ã–±–æ—Ä–∞ –Ω—É–∂–Ω—ã—Ö –ø–æ–ª–µ–π
- –ò–∑–±–µ–≥–∞–π—Ç–µ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é `include`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞–≥–∏–Ω–∞—Ü–∏—é –¥–ª—è —Å–ø–∏—Å–∫–æ–≤

### NestJS –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ `Promise.all`
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ payload —Ä–∞–∑–º–µ—Ä–æ–≤

---

## ü§ñ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

### –ö–æ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π:

1. **–ü—Ä–∏ 404 –æ—à–∏–±–∫–∞—Ö –≤ —Ç–µ—Å—Ç–∞—Ö** ‚Üí [–†–µ—à–µ–Ω–∏–µ](#–ø—Ä–æ–±–ª–µ–º–∞-404-–æ—à–∏–±–∫–∏-–≤-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö-—Ç–µ—Å—Ç–∞—Ö)
2. **–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å Sequelize** ‚Üí [–°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è](#–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è-—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è-sequelize-–º–æ–¥–µ–ª–µ–π)
3. **–ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤** ‚Üí [–ü–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤](#–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π-–ø–æ—Ä—è–¥–æ–∫-–¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤-–≤-nestjs)
4. **–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å —Ç–µ—Å—Ç–∞–º–∏** ‚Üí [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#best-practices-–¥–ª—è-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö-—Ç–µ—Å—Ç–æ–≤)
5. **–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å unicode** ‚Üí [Unicode —Å–∏–º–≤–æ–ª—ã](#best-practices-–¥–ª—è-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö-—Ç–µ—Å—Ç–æ–≤)
6. **–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å rate limiting** ‚Üí [Rate limiting](#–ø—Ä–æ–±–ª–µ–º–∞-rate-limiting-–≤-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö-—Ç–µ—Å—Ç–∞—Ö)

### –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–µ—Å—Ç
npm test -- --testNamePattern="special characters"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
npm test -- --testPathPattern="user-preferences"

# –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
npm test -- --runInBand

# Coverage –æ—Ç—á–µ—Ç—ã
npm run test:cov                    # –≤—Å–µ —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
npm run test:cov:open               # –æ—Ç–∫—Ä—ã—Ç—å HTML –æ—Ç—á–µ—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
npm run test:cov:unit               # —Ç–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
npm run test:cov:integration        # —Ç–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
```

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-01-05  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** online-store-backend v1.0  
**–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:** [–ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–µ–∫—Ç–∞](./project-rules.md)
