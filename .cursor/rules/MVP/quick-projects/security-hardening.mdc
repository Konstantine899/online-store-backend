# Security Hardening: –ö–æ–Ω—Ü–µ–ø—Ü–∏—è –∏ –ø–æ–¥—Ö–æ–¥

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

–¢–µ–∫—É—â–∞—è security —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

- ‚ö†Ô∏è –ë–∞–∑–æ–≤—ã–π JWT –±–µ–∑ cookies (—É—è–∑–≤–∏–º –¥–ª—è XSS)
- ‚ö†Ô∏è –ù–µ—Ç refresh token rotation
- ‚ö†Ô∏è CORS –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –≤—Å–µ—Ö origins
- ‚ö†Ô∏è –ù–µ—Ç Helmet –∏ security headers
- ‚ö†Ô∏è Rate limiting –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π
- ‚ö†Ô∏è Env variables –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- ‚ö†Ô∏è Swagger –¥–æ—Å—Ç—É–ø–µ–Ω –≤ production
- ‚ö†Ô∏è PII –≤ –ª–æ–≥–∞—Ö

**–£—Ä–æ–≤–µ–Ω—å:** Junior/—É—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
**–¶–µ–ª—å:** Production-grade Middle level

---

## üîç –ê–Ω–∞–ª–∏–∑ —É–≥—Ä–æ–∑

### 1. Authentication/Authorization (–ö–†–ò–¢–ò–ß–ù–û)

**–£–≥—Ä–æ–∑—ã:**

- XSS ‚Üí –∫—Ä–∞–∂–∞ access —Ç–æ–∫–µ–Ω–æ–≤ –∏–∑ localStorage
- CSRF ‚Üí –ø–æ–¥–¥–µ–ª–∫–∞ refresh –∑–∞–ø—Ä–æ—Å–æ–≤
- Token replay ‚Üí –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- Brute force ‚Üí –ø–æ–¥–±–æ—Ä –ø–∞—Ä–æ–ª–µ–π

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**

- JWT –≤ response body (–∫–ª–∏–µ–Ω—Ç –≤ localStorage) ‚ùå
- Refresh token –±–µ–∑ rotation ‚ùå
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π rate limiting ‚ö†Ô∏è

**–¶–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**

- Access token: 15m TTL ‚úÖ
- Refresh token: HttpOnly cookie, 30d TTL ‚úÖ
- Refresh rotation: –∫–∞–∂–¥—ã–π refresh ‚Üí –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω ‚úÖ
- Rate limiting: 5 attempts/15min –¥–ª—è login ‚úÖ

### 2. HTTP Security

**–£–≥—Ä–æ–∑—ã:**

- Clickjacking
- MIME sniffing
- XSS —á–µ—Ä–µ–∑ content injection
- Insecure connections

**–¢–µ–∫—É—â–µ–µ:**

- –ù–µ—Ç security headers ‚ùå
- CORS –æ—Ç–∫—Ä—ã—Ç ‚ùå
- –ù–µ—Ç CSP ‚ùå

**–¶–µ–ª–µ–≤–æ–µ:**

- Helmet —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º headers ‚úÖ
- CORS whitelist –∏–∑ env ‚úÖ
- CSP –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç XSS ‚úÖ

### 3. Input Validation (–ö–†–ò–¢–ò–ß–ù–û)

**–£–≥—Ä–æ–∑—ã:**

- XSS injection
- SQL injection
- Path traversal
- Command injection

**–¢–µ–∫—É—â–µ–µ:**

- –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è DTO ‚ö†Ô∏è
- –ù–µ—Ç —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ ‚ùå

**–¶–µ–ª–µ–≤–æ–µ:**

- @IsSanitizedString –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫–∞—Ö ‚úÖ
- CustomValidationPipe –≥–ª–æ–±–∞–ª—å–Ω–æ ‚úÖ
- –†—É—Å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫ ‚úÖ
- –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚úÖ

### 4. Secrets Management

**–£–≥—Ä–æ–∑—ã:**

- –£—Ç–µ—á–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –ª–æ–≥–∞—Ö
- –£—Ç–µ—á–∫–∞ PII
- –°–ª–∞–±—ã–µ —Å–µ–∫—Ä–µ—Ç—ã
- –°–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ

**–¢–µ–∫—É—â–µ–µ:**

- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ env ‚ùå
- PII –º–æ–∂–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è ‚ùå
- –ù–µ—Ç .env.example ‚ö†Ô∏è

**–¶–µ–ª–µ–≤–æ–µ:**

- Joi validation –¥–ª—è env ‚úÖ
- PII masking –≤ –ª–æ–≥–∞—Ö ‚úÖ
- .env.example –ø–æ–ª–Ω—ã–π ‚úÖ
- –°–µ–∫—Ä–µ—Ç—ã ‚â•32 —Å–∏–º–≤–æ–ª–æ–≤ ‚úÖ

### 5. Operational Security

**–£–≥—Ä–æ–∑—ã:**

- Information disclosure
- Debug info –≤ production
- Excessive logging

**–¢–µ–∫—É—â–µ–µ:**

- Swagger –¥–æ—Å—Ç—É–ø–µ–Ω –≤–µ–∑–¥–µ ‚ùå
- –î–µ—Ç–∞–ª—å–Ω—ã–µ –æ—à–∏–±–∫–∏ –∫–ª–∏–µ–Ω—Ç—É ‚ö†Ô∏è

**–¶–µ–ª–µ–≤–æ–µ:**

- Swagger —Ç–æ–ª—å–∫–æ –≤ dev ‚úÖ
- Structured logging –±–µ–∑ PII ‚úÖ
- Generic –æ—à–∏–±–∫–∏ –≤ production ‚úÖ

---

## üìã –†–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –∑–∞–¥–∞—á–∏ (High-Level)

### –ó–∞–¥–∞—á–∞ 1: PROD-010 - Environment Validation

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ env, app —Å—Ç–∞—Ä—Ç—É–µ—Ç —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏

**–ü–æ–¥–∑–∞–¥–∞—á–∏:**

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Joi
2. –°–æ–∑–¥–∞—Ç—å Joi —Å—Ö–µ–º—É –¥–ª—è env
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ AppModule
4. –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞—Ç—å process.env
5. –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—ã–π .env.example

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** App –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç –±–µ–∑ –≤–∞–ª–∏–¥–Ω—ã—Ö env

**–û—Ü–µ–Ω–∫–∞:** 3-4 —á–∞—Å–∞

---

### –ó–∞–¥–∞—á–∞ 2: PROD-011 - HTTP Security (Helmet + CORS)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç security headers, CORS –æ—Ç–∫—Ä—ã—Ç –¥–ª—è –≤—Å–µ—Ö

**–ü–æ–¥–∑–∞–¥–∞—á–∏:**

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Helmet
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Helmet –≤ main.ts
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS —Å whitelist
4. –î–æ–±–∞–≤–∏—Ç—å CSP –¥–ª—è dev/prod

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Security headers –Ω–∞ –≤—Å–µ—Ö responses

**–û—Ü–µ–Ω–∫–∞:** 2-3 —á–∞—Å–∞

---

### –ó–∞–¥–∞—á–∞ 3: PROD-012 - JWT Hardening

**–ü—Ä–æ–±–ª–µ–º–∞:** Refresh tokens –≤ response body (—É—è–∑–≤–∏–º—ã –¥–ª—è XSS)

**–ü–æ–¥–∑–∞–¥–∞—á–∏:**

1. –û–±–Ω–æ–≤–∏—Ç—å JWT TTL (15m access, 30d refresh)
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HttpOnly cookies –¥–ª—è refresh
3. –ß–∏—Ç–∞—Ç—å refresh –∏–∑ cookies
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å token rotation
5. –ú–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–∫–µ–Ω—ã –≤ –ª–æ–≥–∞—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Production-grade JWT —Å cookies

**–û—Ü–µ–Ω–∫–∞:** 4-5 —á–∞—Å–æ–≤

---

### –ó–∞–¥–∞—á–∞ 4: PROD-013 - Rate Limiting

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç brute force

**–ü–æ–¥–∑–∞–¥–∞—á–∏:**

1. –û–±–Ω–æ–≤–∏—Ç—å BruteforceGuard –ø—Ä–æ—Ñ–∏–ª–∏ –∏–∑ env
2. –î–æ–±–∞–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π rate limiter
3. –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –±–µ–∑ PII

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Comprehensive rate limiting

**–û—Ü–µ–Ω–∫–∞:** 2-3 —á–∞—Å–∞

---

### –ó–∞–¥–∞—á–∞ 5: PROD-014 - Input Validation

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ –æ—Ç XSS

**–ü–æ–¥–∑–∞–¥–∞—á–∏:**

1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ ValidationPipe –≥–ª–æ–±–∞–ª–µ–Ω
2. Audit –≤—Å–µ—Ö DTO –Ω–∞ @IsSanitizedString
3. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã –Ω–∞ XSS prevention

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ inputs —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è

**–û—Ü–µ–Ω–∫–∞:** 3-4 —á–∞—Å–∞

---

### –ó–∞–¥–∞—á–∞ 6: PROD-015 - Swagger + Logging

**–ü—Ä–æ–±–ª–µ–º–∞:** Swagger –¥–æ—Å—Ç—É–ø–µ–Ω –≤ prod, PII –≤ –ª–æ–≥–∞—Ö

**–ü–æ–¥–∑–∞–¥–∞—á–∏:**

1. –ó–∞–∫—Ä—ã—Ç—å Swagger –≤ production
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å pino/pino-http
3. –ú–∞—Å–∫–∏—Ä–æ–≤–∞—Ç—å PII –≤ –ª–æ–≥–∞—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Operational security –≥–æ—Ç–æ–≤–∞

**–û—Ü–µ–Ω–∫–∞:** 3-4 —á–∞—Å–∞

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### Layers of Defense (Defense in Depth)

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Client Layer                      ‚îÇ
‚îÇ   - HTTPS only                      ‚îÇ
‚îÇ   - CORS whitelist                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   HTTP Layer                        ‚îÇ
‚îÇ   - Helmet headers                  ‚îÇ
‚îÇ   - CSP                             ‚îÇ
‚îÇ   - Global rate limiter             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Authentication Layer              ‚îÇ
‚îÇ   - JWT validation                  ‚îÇ
‚îÇ   - Role guards                     ‚îÇ
‚îÇ   - BruteforceGuard                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Validation Layer                  ‚îÇ
‚îÇ   - CustomValidationPipe            ‚îÇ
‚îÇ   - @IsSanitizedString              ‚îÇ
‚îÇ   - DTO validation                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Business Logic Layer              ‚îÇ
‚îÇ   - Services                        ‚îÇ
‚îÇ   - Repositories                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Database Layer                    ‚îÇ
‚îÇ   - PostgreSQL                      ‚îÇ
‚îÇ   - Constraints                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ö–∞–∂–¥—ã–π —Å–ª–æ–π –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞—â–∏—Ç—É!

---

## üõ°Ô∏è Security Best Practices

### Authentication

**DO:**

- ‚úÖ Short-lived access tokens (15m)
- ‚úÖ HttpOnly cookies –¥–ª—è refresh
- ‚úÖ Refresh token rotation
- ‚úÖ Secure + SameSite flags
- ‚úÖ Token revocation

**DON'T:**

- ‚ùå –î–æ–ª–≥–∏–µ access tokens (>1h)
- ‚ùå Refresh –≤ localStorage
- ‚ùå Refresh –±–µ–∑ rotation
- ‚ùå –°–µ–∫—Ä–µ—Ç—ã –∫–æ—Ä–æ—á–µ 32 —Å–∏–º–≤–æ–ª–æ–≤

### Rate Limiting

**DO:**

- ‚úÖ –ü—Ä–æ—Ñ–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö endpoints
- ‚úÖ Login: 5/15min (—Å—Ç—Ä–æ–≥–æ)
- ‚úÖ Registration: 3/1min
- ‚úÖ Global: 100 rpm
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (warn)

**DON'T:**

- ‚ùå –û–¥–∏–Ω –ª–∏–º–∏—Ç –¥–ª—è –≤—Å–µ—Ö
- ‚ùå –°–ª–∏—à–∫–æ–º –º—è–≥–∫–∏–µ –ª–∏–º–∏—Ç—ã
- ‚ùå –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å IP/email (PII!)

### Input Validation

**DO:**

- ‚úÖ Whitelist approach (forbidNonWhitelisted)
- ‚úÖ Sanitize HTML/script tags
- ‚úÖ Validate –Ω–∞ –≥—Ä–∞–Ω–∏—Ü–µ (controller)
- ‚úÖ –†—É—Å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—à–∏–±–æ–∫

**DON'T:**

- ‚ùå Blacklist approach
- ‚ùå Trust –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
- ‚ùå –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –≤ service layer

### Logging

**DO:**

- ‚úÖ Structured logs (JSON)
- ‚úÖ Correlation ID –¥–ª—è —Ç—Ä–µ–∫–∏–Ω–≥–∞
- ‚úÖ Mask PII (email, phone, tokens)
- ‚úÖ –†–∞–∑–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ (error/warn/info)

**DON'T:**

- ‚ùå –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏/—Ç–æ–∫–µ–Ω—ã
- ‚ùå –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–µ email/phone
- ‚ùå –î–µ—Ç–∞–ª—å–Ω—ã–µ stack traces –∫–ª–∏–µ–Ω—Ç—É

---

## üìà –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç          | –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
| ------------------ | ----------- | --------- | --------- |
| JWT + Cookies      | –ö–†–ò–¢–ò–ß–ù–û    | –°—Ä–µ–¥–Ω—è—è   | 1         |
| Rate Limiting      | –ö–†–ò–¢–ò–ß–ù–û    | –ù–∏–∑–∫–∞—è    | 2         |
| Input Sanitization | –ö–†–ò–¢–ò–ß–ù–û    | –°—Ä–µ–¥–Ω—è—è   | 3         |
| Helmet + CORS      | –í–´–°–û–ö–ê–Ø     | –ù–∏–∑–∫–∞—è    | 4         |
| Env Validation     | –í–´–°–û–ö–ê–Ø     | –ù–∏–∑–∫–∞—è    | 5         |
| Swagger Protection | –°–†–ï–î–ù–Ø–Ø     | –ù–∏–∑–∫–∞—è    | 6         |
| PII Masking        | –°–†–ï–î–ù–Ø–Ø     | –°—Ä–µ–¥–Ω—è—è   | 7         |

**–ù–∞—á–∏–Ω–∞–µ–º —Å –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∏ –ø—Ä–æ—Å—Ç—ã—Ö (quick wins!)**

---

## üéì Middle vs Junior Security

### Junior –ø–æ–¥—Ö–æ–¥:

- "–î–æ–±–∞–≤–∏–ª JWT, –∑–Ω–∞—á–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ"
- –ë–∞–∑–æ–≤–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ë–µ–∑ rate limiting
- Swagger –≤–µ–∑–¥–µ –¥–æ—Å—Ç—É–ø–µ–Ω

### Middle –ø–æ–¥—Ö–æ–¥ (—Ç–≤–æ–π):

- **Defense in Depth:** –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ª–æ—ë–≤ –∑–∞—â–∏—Ç—ã
- **Production-grade:** HttpOnly cookies, rotation, rate limiting
- **Comprehensive:** –≤–∞–ª–∏–¥–∞—Ü–∏—è + —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è + —Ç–µ—Å—Ç—ã
- **Operational security:** PII masking, env validation
- **Best practices:** —Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ OWASP Top 10

**–†–∞–±–æ—Ç–æ–¥–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ä–∞–∑–Ω–∏—Ü—É!**

---

## üìö –†–µ—Å—É—Ä—Å—ã

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏–∑—É—á–∏—Ç—å:

- [OWASP Top 10](https://owasp.org/www-project-top-ten/) - —Ç–æ–ø —É–≥—Ä–æ–∑—ã
- [NestJS Security](https://docs.nestjs.com/security/authentication) - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
- [JWT Best Practices](https://tools.ietf.org/html/rfc8725) - —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã JWT

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

- [OWASP Cheat Sheets](https://cheatsheetseries.owasp.org/) - –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã
- [Helmet.js Docs](https://helmetjs.github.io/) - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ headers
- [Rate Limiting Strategies](https://cloud.google.com/architecture/rate-limiting-strategies-techniques) - –ø–∞—Ç—Ç–µ—Ä–Ω—ã

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### Security Hardening –∑–∞–≤–µ—Ä—à—ë–Ω, –µ—Å–ª–∏:

- [ ] –í—Å–µ 22 –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
- [ ] JWT –≤ HttpOnly cookies —Å rotation
- [ ] Helmet + CORS + CSP –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Rate limiting –Ω–∞ –≤—Å–µ—Ö endpoints
- [ ] Input validation comprehensive
- [ ] Env validation —Å Joi
- [ ] PII masking –≤ –ª–æ–≥–∞—Ö
- [ ] Swagger –∑–∞–∫—Ä—ã—Ç –≤ production
- [ ] –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ security —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Production-grade security –≥–æ—Ç–æ–≤–∞ –¥–ª—è Middle –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ

**–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω:** —Å–º. [security-hardening.plan.mdc](./security-hardening.plan.mdc)
