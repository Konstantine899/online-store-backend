# SaaS Execution Plan (Binding)

binding: true
owner: platform
version: 1.0

execution_policy:
must_follow: true
allow_code_changes_only_after: "–û–¥–æ–±—Ä—è—é <TASK_ID>"
triggers: - "–ü–ª–∞–Ω–∏—Ä—É–π": update this file only - "–ü–æ–∫–∞–∂–∏ –∫–æ–¥ <TASK_ID>": show diffs/commands, no changes - "–û–¥–æ–±—Ä—è—é <TASK_ID>": implement exactly that task - "–ö–æ–º–º–∏—Ç <TASK_ID>": commit & prepare PR notes
constraints: - no public API changes without explicit approval - changes only within task files_scope - pass lints/tests before marking DoD done

roadmap:
epic: SAAS-CORE
description: Global roadmap for multi-tenant SaaS platform (universal, not tied to specific business domain)

references:

- ‚ö†Ô∏è –ê–†–•–ò–í: user.plan.mdc, user-atomic.plan.mdc, user.mdc –ø–µ—Ä–µ–º–µ—â–µ–Ω—ã –≤ models/archive/ (–∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞–ª–∏ —Å SaaS –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π)

# DEFAULT PRE-COMMIT WORKFLOW –¥–ª—è –≤—Å–µ—Ö SaaS core –∑–∞–¥–∞—á

default_pre_commit_workflow: "–¢–©–ê–¢–ï–õ–¨–ù–´–ô (–∫—Ä–∏—Ç–∏—á–Ω—ã–π –º–æ–¥—É–ª—å: SaaS core/multi-tenancy)"
default_pre_commit_steps:

- "¬´–†–µ–≤—å—é¬ª ‚Üí tenant isolation, multi-tenancy logic, security"
- "¬´–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π¬ª ‚Üí DB queries, tenant scoping performance"
- "¬´–ê–≤—Ç–æ—Ñ–∏–∫—Å¬ª ‚Üí linter/prettier"
- "–¢–µ—Å—Ç—ã: tenant isolation tests, integration tests"
- "Coverage: SaaS core ‚â•80%"
- "¬´–ö–æ–º–º–∏—Ç¬ª ‚Üí feat(saas): <TASK_ID> complete"

tasks:

- id: SAAS-001
  title: Enable multi-tenant core (DB + Middleware + Scope)
  branch: "feature/infra/SAAS-001/enable-multi-tenant-core"
  pre_commit_workflow: "–¢–©–ê–¢–ï–õ–¨–ù–´–ô (–∫—Ä–∏—Ç–∏—á–Ω—ã–π –º–æ–¥—É–ª—å: SaaS core/multi-tenancy)"
  pre_commit_steps:
    - "¬´–†–µ–≤—å—é¬ª ‚Üí tenant isolation, multi-tenancy logic, security"
    - "¬´–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π¬ª ‚Üí DB queries, tenant scoping performance"
    - "¬´–ê–≤—Ç–æ—Ñ–∏–∫—Å¬ª ‚Üí linter/prettier"
    - "–¢–µ—Å—Ç—ã: tenant isolation tests, integration tests"
    - "Coverage: SaaS core ‚â•80%"
    - "¬´–ö–æ–º–º–∏—Ç¬ª ‚Üí feat(saas): <TASK_ID> complete"
      files_scope:
    - "db/migrations/\*\*"
    - "src/infrastructure/common/middleware/\*\*"
    - "src/infrastructure/repositories/\*\*"
    - "src/main.ts"
    - "src/infrastructure/common/swagger/\*\*"
      steps:
    - create tenants and tenant_users migrations with indexes
    - add tenant_id to core tables + indexes + backfill
    - tenant middleware resolve by x-tenant-id or subdomain
    - enforce tenant filter in repositories via helper/scope
    - document global x-tenant-id header in Swagger
      dod:
    - migrations up/down succeed transactionally
    - deterministic backfill to default tenant
    - missing x-tenant-id -> 400; with header -> isolated data
    - integration tests green for isolation
    - Swagger documents x-tenant-id as global header
      gate:
    - require: "–û–¥–æ–±—Ä—è—é SAAS-001"

- id: SAAS-002
  title: User module MVP cleanup (remove e-commerce hardcoded roles)
  branch: "feature/user/SAAS-002/user-mvp-cleanup"
  context: |
  –¶–ï–õ–¨: –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å User –º–æ–¥—É–ª—å –∏–∑ e-commerce —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –≤ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π SaaS –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.
  –£–î–ê–õ–Ø–ï–ú: –•–∞—Ä–¥–∫–æ–¥ –±–∏–∑–Ω–µ—Å-—Ä–æ–ª–µ–π (VIP, Premium, Wholesale, Employee, Affiliate, HighValue, Beta)
  –û–°–¢–ê–í–õ–Ø–ï–ú: Lifecycle —Ñ–ª–∞–≥–∏ (active/blocked/suspended/deleted, email/phone verified)
  pre_commit_workflow: "–û–ë–´–ß–ù–´–ô (User API refactoring)"
  pre_commit_steps:
    - "¬´–†–µ–≤—å—é¬ª ‚Üí API contracts, breaking changes check"
    - "¬´–ê–≤—Ç–æ—Ñ–∏–∫—Å¬ª ‚Üí linter/prettier"
    - "–¢–µ—Å—Ç—ã: unit + integration tests"
    - "¬´–ö–æ–º–º–∏—Ç¬ª ‚Üí feat(user): <TASK_ID> complete"
      files_scope:
    - "src/infrastructure/controllers/user/\*\*"
    - "src/infrastructure/services/user/\*\*"
    - "src/infrastructure/repositories/user/\*\*"
    - "src/infrastructure/dto/user/\*\*"
    - "src/domain/models/user.model.ts"
    - "src/domain/services/i-user-service.ts"
    - "src/domain/repositories/i-user-repository.ts"
    - "tests/integration/controllers/user/\*\*"
      steps:
    - "‚ùå –£–î–ê–õ–ò–¢–¨ 12 endpoints: /admin/vip/set|unset, /admin/premium/upgrade|downgrade, /admin/employee/set|unset, /admin/highvalue/set|unset, /admin/wholesale/set|unset, /admin/affiliate/set|unset"
    - "‚ùå –£–î–ê–õ–ò–¢–¨ 12 –º–µ—Ç–æ–¥–æ–≤ –∏–∑ UserService: setVip/unsetVip, upgradePremium/downgradePremium, setEmployee/unsetEmployee, setHighValue/unsetHighValue, setWholesale/unsetWholesale, setAffiliate/unsetAffiliate"
    - "‚ùå –£–î–ê–õ–ò–¢–¨ 12 –º–µ—Ç–æ–¥–æ–≤ –∏–∑ UserRepository: —Ç–æ –∂–µ —Å–∞–º–æ–µ"
    - "‚ùå –£–î–ê–õ–ò–¢–¨ 6 –ø–æ–ª–µ–π –∏–∑ UserModel: isVipCustomer, isPremium, isAffiliate, isEmployee, isHighValue, isWholesale"
    - "‚ùå –£–î–ê–õ–ò–¢–¨ 3 –ø–æ–ª—è –∏–∑ UpdateUserFlagsDto: isVipCustomer, isBetaTester, isPremium"
    - "‚ùå –£–î–ê–õ–ò–¢–¨ –∏–∑ getUserStats() –ø–æ–¥—Å—á–µ—Ç: vipUsers, premiumUsers, employees, affiliates, wholesaleUsers, highValueUsers"
    - "‚úÖ –û–°–¢–ê–í–ò–¢–¨ lifecycle endpoints: /admin/block|unblock, /admin/suspend|unsuspend, /admin/delete|restore, /verify/email|phone"
    - "‚úÖ –û–°–¢–ê–í–ò–¢–¨ lifecycle —Ñ–ª–∞–≥–∏: isActive, isBlocked, isSuspended, isDeleted, isEmailVerified, isPhoneVerified"
    - "‚úÖ –û–°–¢–ê–í–ò–¢–¨ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏: isNewsletterSubscribed, isMarketingConsent, isCookieConsent, isProfileCompleted, isTermsAccepted, isPrivacyAccepted, isAgeVerified, isTwoFactorEnabled"
    - "üîí –î–û–ë–ê–í–ò–¢–¨ BruteforceGuard –¥–ª—è verify routes (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)"
    - "üìù –û–ë–ù–û–í–ò–¢–¨ domain –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (IUserService, IUserRepository) - —É–±—Ä–∞—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã"
    - "üß™ –û–ë–ù–û–í–ò–¢–¨ —Ç–µ—Å—Ç—ã: —É–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö endpoints"
      dod:
    - ‚ùå –í—Å–µ 12 –±–∏–∑–Ω–µ—Å-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö endpoints —É–¥–∞–ª–µ–Ω—ã
    - ‚ùå –í—Å–µ 36 –º–µ—Ç–æ–¥–æ–≤ —É–¥–∞–ª–µ–Ω—ã (12 –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä + 12 —Å–µ—Ä–≤–∏—Å + 12 —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π)
    - ‚ùå –í—Å–µ 9 –ø–æ–ª–µ–π —É–¥–∞–ª–µ–Ω—ã (6 –º–æ–¥–µ–ª—å + 3 DTO)
    - ‚úÖ Lifecycle endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
    - ‚úÖ –ö–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ (0 –æ—à–∏–±–æ–∫ TypeScript)
    - ‚úÖ –õ–∏–Ω—Ç–µ—Ä —É—Å–ø–µ—à–µ–Ω (0 –æ—à–∏–±–æ–∫ ESLint)
    - ‚úÖ Unit/integration —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ (–æ—Å—Ç–∞–≤—à–∏–µ—Å—è)
    - ‚úÖ Swagger –æ–±–Ω–æ–≤–ª—ë–Ω (—É–¥–∞–ª—ë–Ω–Ω—ã–µ endpoints –Ω–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã)
    - üîí BruteforceGuard –¥–æ–±–∞–≤–ª–µ–Ω –¥–ª—è /verify/\* routes
      gate:
    - require: "–û–¥–æ–±—Ä—è—é SAAS-002"

- id: SAAS-003
  title: Catalog tenant filters and pagination
  branch: "feature/catalog/SAAS-003/tenant-pagination"
  pre_commit_workflow: "–û–ë–´–ß–ù–´–ô (Catalog refactoring)"
  pre_commit_steps:
    - "¬´–†–µ–≤—å—é¬ª ‚Üí pagination contracts, tenant filters"
    - "¬´–û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π¬ª ‚Üí DB queries, indexes"
    - "¬´–ê–≤—Ç–æ—Ñ–∏–∫—Å¬ª ‚Üí linter/prettier"
    - "–¢–µ—Å—Ç—ã: integration tests for pagination"
    - "¬´–ö–æ–º–º–∏—Ç¬ª ‚Üí feat(catalog): <TASK_ID> complete"
      files_scope:
    - "src/infrastructure/controllers/product/\*\*"
    - "src/infrastructure/repositories/product/\*\*"
    - "src/infrastructure/services/product/\*\*"
    - "db/migrations/\*\*"
      steps:
    - add tenant filters to all product queries
    - ensure pagination contract { data, meta }
    - add required indexes for performance
      dod:
    - product lists are tenant-isolated and paginated
    - integration tests for success and error pass
      gate:
    - require: "–û–¥–æ–±—Ä—è—é SAAS-003"

notes:

- Any change to this plan must be requested via trigger "–ü–ª–∞–Ω–∏—Ä—É–π" and approved.
