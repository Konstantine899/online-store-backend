# –°–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫ (Discount System) - Ecommerce Edition

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏ —Ü–µ–ª—å
–°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏—á–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã —Å–∫–∏–¥–æ–∫ –¥–ª—è ecommerce –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å –±–∞–∑–æ–≤—ã–º–∏ —Ç–∏–ø–∞–º–∏ —Å–∫–∏–¥–æ–∫, —Ñ–æ–∫—É—Å–æ–º –Ω–∞ –±—ã—Å—Ç—Ä—É—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é.

## –û—Å–Ω–æ–≤–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–¢–∏–ø—ã —Å–∫–∏–¥–æ–∫** - –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è** - –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é, –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–µ
- **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ —Å–∫–∏–¥–æ–∫
- **–ò—Å—Ç–æ—Ä–∏—è** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ** - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `discounts`
```sql
CREATE TABLE discounts (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    type VARCHAR(20) NOT NULL CHECK (type IN ('percentage', 'fixed', 'free_shipping')),
    value DECIMAL(10,2) NOT NULL,
    min_order_amount DECIMAL(10,2) DEFAULT 0.00,
    max_discount DECIMAL(10,2),
    usage_limit INTEGER,
    usage_count INTEGER DEFAULT 0,
    user_limit INTEGER DEFAULT 1,
    valid_from TIMESTAMP NOT NULL,
    valid_to TIMESTAMP NOT NULL,
    is_active BOOLEAN DEFAULT true,
    is_automatic BOOLEAN DEFAULT false,
    applicable_products INTEGER[],
    applicable_categories INTEGER[],
    applicable_brands INTEGER[],
    priority INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### –¢–∞–±–ª–∏—Ü–∞ `discount_applications`
```sql
CREATE TABLE discount_applications (
    id SERIAL PRIMARY KEY,
    discount_id INTEGER REFERENCES discounts(id) ON DELETE CASCADE,
    user_id INTEGER REFERENCES users(id) ON DELETE CASCADE,
    order_id INTEGER REFERENCES orders(id) ON DELETE CASCADE,
    discount_amount DECIMAL(10,2) NOT NULL,
    applied_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## –ú–æ–¥–µ–ª–∏ Sequelize

### Discount Model
```typescript
// src/domain/models/discount.model.ts
import { Model, DataType, Column, Table, HasMany } from 'sequelize-typescript';
import { DiscountApplicationModel } from './discount-application.model';

export enum DiscountType {
    PERCENTAGE = 'percentage',
    FIXED = 'fixed',
    FREE_SHIPPING = 'free_shipping'
}

interface IDiscountModel {
    id: number;
    name: string;
    description?: string;
    type: DiscountType;
    value: number;
    minOrderAmount: number;
    maxDiscount?: number;
    usageLimit?: number;
    usageCount: number;
    userLimit: number;
    validFrom: Date;
    validTo: Date;
    isActive: boolean;
    isAutomatic: boolean;
    applicableProducts?: number[];
    applicableCategories?: number[];
    applicableBrands?: number[];
    priority: number;
    applications: DiscountApplicationModel[];
    createdAt: Date;
    updatedAt: Date;
}

interface IDiscountCreationAttributes {
    name: string;
    description?: string;
    type: DiscountType;
    value: number;
    minOrderAmount?: number;
    maxDiscount?: number;
    usageLimit?: number;
    userLimit?: number;
    validFrom: Date;
    validTo: Date;
    isActive?: boolean;
    isAutomatic?: boolean;
    applicableProducts?: number[];
    applicableCategories?: number[];
    applicableBrands?: number[];
    priority?: number;
}

@Table({
    tableName: 'discounts',
    underscored: true,
    timestamps: true,
    indexes: [
        { fields: ['type'], name: 'idx_discounts_type' },
        { fields: ['is_active'], name: 'idx_discounts_is_active' },
        { fields: ['is_automatic'], name: 'idx_discounts_is_automatic' },
        { fields: ['valid_from', 'valid_to'], name: 'idx_discounts_validity' },
        { fields: ['priority'], name: 'idx_discounts_priority' },
    ],
})
export class DiscountModel
    extends Model<DiscountModel, IDiscountCreationAttributes>
    implements IDiscountModel
{
    @Column({
        type: DataType.INTEGER,
        primaryKey: true,
        autoIncrement: true,
    })
    declare id: number;

    @Column({
        type: DataType.STRING(100),
        allowNull: false,
    })
    declare name: string;

    @Column({
        type: DataType.TEXT,
        allowNull: true,
    })
    declare description: string;

    @Column({
        type: DataType.ENUM(...Object.values(DiscountType)),
        allowNull: false,
    })
    declare type: DiscountType;

    @Column({
        type: DataType.DECIMAL(10, 2),
        allowNull: false,
    })
    declare value: number;

    @Column({
        type: DataType.DECIMAL(10, 2),
        allowNull: false,
        defaultValue: 0.00,
        field: 'min_order_amount',
    })
    declare minOrderAmount: number;

    @Column({
        type: DataType.DECIMAL(10, 2),
        allowNull: true,
        field: 'max_discount',
    })
    declare maxDiscount: number;

    @Column({
        type: DataType.INTEGER,
        allowNull: true,
        field: 'usage_limit',
    })
    declare usageLimit: number;

    @Column({
        type: DataType.INTEGER,
        allowNull: false,
        defaultValue: 0,
        field: 'usage_count',
    })
    declare usageCount: number;

    @Column({
        type: DataType.INTEGER,
        allowNull: false,
        defaultValue: 1,
        field: 'user_limit',
    })
    declare userLimit: number;

    @Column({
        type: DataType.DATE,
        allowNull: false,
        field: 'valid_from',
    })
    declare validFrom: Date;

    @Column({
        type: DataType.DATE,
        allowNull: false,
        field: 'valid_to',
    })
    declare validTo: Date;

    @Column({
        type: DataType.BOOLEAN,
        allowNull: false,
        defaultValue: true,
        field: 'is_active',
    })
    declare isActive: boolean;

    @Column({
        type: DataType.BOOLEAN,
        allowNull: false,
        defaultValue: false,
        field: 'is_automatic',
    })
    declare isAutomatic: boolean;

    @Column({
        type: DataType.ARRAY(DataType.INTEGER),
        allowNull: true,
        field: 'applicable_products',
    })
    declare applicableProducts: number[];

    @Column({
        type: DataType.ARRAY(DataType.INTEGER),
        allowNull: true,
        field: 'applicable_categories',
    })
    declare applicableCategories: number[];

    @Column({
        type: DataType.ARRAY(DataType.INTEGER),
        allowNull: true,
        field: 'applicable_brands',
    })
    declare applicableBrands: number[];

    @Column({
        type: DataType.INTEGER,
        allowNull: false,
        defaultValue: 0,
    })
    declare priority: number;

    @HasMany(() => DiscountApplicationModel)
    declare applications: DiscountApplicationModel[];
}
```

### DiscountApplication Model
```typescript
// src/domain/models/discount-application.model.ts
import { Model, DataType, Column, Table, BelongsTo, ForeignKey } from 'sequelize-typescript';
import { DiscountModel } from './discount.model';
import { UserModel } from './user.model';
import { OrderModel } from './order.model';

interface IDiscountApplicationModel {
    id: number;
    discountId: number;
    userId: number;
    orderId: number;
    discountAmount: number;
    discount: DiscountModel;
    user: UserModel;
    order: OrderModel;
    appliedAt: Date;
}

interface IDiscountApplicationCreationAttributes {
    discountId: number;
    userId: number;
    orderId: number;
    discountAmount: number;
}

@Table({
    tableName: 'discount_applications',
    underscored: true,
    timestamps: true,
    createdAt: 'appliedAt',
    updatedAt: false,
    indexes: [
        { fields: ['discount_id'], name: 'idx_discount_applications_discount_id' },
        { fields: ['user_id'], name: 'idx_discount_applications_user_id' },
        { fields: ['order_id'], name: 'idx_discount_applications_order_id' },
        { fields: ['applied_at'], name: 'idx_discount_applications_applied_at' },
    ],
})
export class DiscountApplicationModel
    extends Model<DiscountApplicationModel, IDiscountApplicationCreationAttributes>
    implements IDiscountApplicationModel
{
    @Column({
        type: DataType.INTEGER,
        primaryKey: true,
        autoIncrement: true,
    })
    declare id: number;

    @ForeignKey(() => DiscountModel)
    @Column({
        type: DataType.INTEGER,
        allowNull: false,
        field: 'discount_id',
    })
    declare discountId: number;

    @ForeignKey(() => UserModel)
    @Column({
        type: DataType.INTEGER,
        allowNull: false,
        field: 'user_id',
    })
    declare userId: number;

    @ForeignKey(() => OrderModel)
    @Column({
        type: DataType.INTEGER,
        allowNull: false,
        field: 'order_id',
    })
    declare orderId: number;

    @Column({
        type: DataType.DECIMAL(10, 2),
        allowNull: false,
        field: 'discount_amount',
    })
    declare discountAmount: number;

    @Column({
        type: DataType.DATE,
        allowNull: false,
        defaultValue: DataType.NOW,
        field: 'applied_at',
    })
    declare appliedAt: Date;

    @BelongsTo(() => DiscountModel)
    declare discount: DiscountModel;

    @BelongsTo(() => UserModel)
    declare user: UserModel;

    @BelongsTo(() => OrderModel)
    declare order: OrderModel;
}
```

## –°–µ—Ä–≤–∏—Å—ã

### Discount Service
```typescript
// src/infrastructure/services/discount.service.ts
import { Injectable, Logger, NotFoundException, BadRequestException } from '@nestjs/common';
import { InjectModel } from '@nestjs/sequelize';
import { DiscountModel, DiscountType } from '@app/domain/models/discount.model';
import { DiscountApplicationModel } from '@app/domain/models/discount-application.model';
import { Op } from 'sequelize';

@Injectable()
export class DiscountService {
    private readonly logger = new Logger(DiscountService.name);

    constructor(
        @InjectModel(DiscountModel)
        private discountModel: typeof DiscountModel,
        @InjectModel(DiscountApplicationModel)
        private discountApplicationModel: typeof DiscountApplicationModel,
    ) {}

    async findAll(
        page: number = 1,
        limit: number = 10,
        search?: string,
        isActive?: boolean,
        type?: DiscountType,
    ): Promise<{ data: DiscountModel[]; total: number }> {
        const where: any = {};

        if (search) {
            where[Op.or] = [
                { name: { [Op.iLike]: `%${search}%` } },
                { description: { [Op.iLike]: `%${search}%` } },
            ];
        }

        if (isActive !== undefined) {
            where.isActive = isActive;
        }

        if (type) {
            where.type = type;
        }

        const { rows: discounts, count: total } = await this.discountModel.findAndCountAll({
            where,
            order: [['priority', 'DESC'], ['created_at', 'DESC']],
            limit,
            offset: (page - 1) * limit,
            include: [
                {
                    model: DiscountApplicationModel,
                    attributes: ['id'],
                    required: false,
                },
            ],
        });

        return { data: discounts, total };
    }

    async findById(id: number): Promise<DiscountModel> {
        const discount = await this.discountModel.findByPk(id, {
            include: [
                {
                    model: DiscountApplicationModel,
                    include: ['user', 'order'],
                    required: false,
                },
            ],
        });

        if (!discount) {
            throw new NotFoundException('–°–∫–∏–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
        }

        return discount;
    }

    async create(discountData: Partial<DiscountModel>): Promise<DiscountModel> {
        const discount = await this.discountModel.create(discountData);
        this.logger.log(`Discount created: ${discount.name} (${discount.type})`);
        return discount;
    }

    async update(id: number, discountData: Partial<DiscountModel>): Promise<DiscountModel> {
        const discount = await this.findById(id);
        await discount.update(discountData);
        this.logger.log(`Discount updated: ${discount.name} (${discount.type})`);
        return discount;
    }

    async delete(id: number): Promise<void> {
        const discount = await this.findById(id);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏
        const applicationCount = await this.discountApplicationModel.count({
            where: { discountId: id },
        });

        if (applicationCount > 0) {
            throw new BadRequestException('–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–∫–∏–¥–∫—É, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å');
        }

        await discount.destroy();
        this.logger.log(`Discount deleted: ${discount.name} (${discount.type})`);
    }

    async validateDiscount(
        discountId: number,
        userId: number,
        orderAmount: number,
        productIds?: number[],
        categoryIds?: number[],
        brandIds?: number[],
    ): Promise<{ isValid: boolean; message?: string; discount?: DiscountModel; discountAmount?: number }> {
        try {
            const discount = await this.findById(discountId);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
            if (!discount.isActive) {
                return { isValid: false, message: '–°–∫–∏–¥–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞' };
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
            const now = new Date();
            if (now < discount.validFrom || now > discount.validTo) {
                return { isValid: false, message: '–°–∫–∏–¥–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç' };
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—É–º–º—É –∑–∞–∫–∞–∑–∞
            if (orderAmount < discount.minOrderAmount) {
                return { 
                    isValid: false, 
                    message: `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–∫–∏: ${discount.minOrderAmount} —Ä—É–±.` 
                };
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
            if (discount.usageLimit && discount.usageCount >= discount.usageLimit) {
                return { isValid: false, message: '–°–∫–∏–¥–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∞' };
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
            const userUsageCount = await this.discountApplicationModel.count({
                where: { discountId: discount.id, userId },
            });

            if (userUsageCount >= discount.userLimit) {
                return { isValid: false, message: '–í—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —ç—Ç—É —Å–∫–∏–¥–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑' };
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –∫ —Ç–æ–≤–∞—Ä–∞–º
            if (discount.applicableProducts && productIds) {
                const hasApplicableProduct = productIds.some(id => 
                    discount.applicableProducts.includes(id)
                );
                if (!hasApplicableProduct) {
                    return { isValid: false, message: '–°–∫–∏–¥–∫–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–∞ –∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–º —Ç–æ–≤–∞—Ä–∞–º' };
                }
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            if (discount.applicableCategories && categoryIds) {
                const hasApplicableCategory = categoryIds.some(id => 
                    discount.applicableCategories.includes(id)
                );
                if (!hasApplicableCategory) {
                    return { isValid: false, message: '–°–∫–∏–¥–∫–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–∞ –∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º' };
                }
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –∫ –±—Ä–µ–Ω–¥–∞–º
            if (discount.applicableBrands && brandIds) {
                const hasApplicableBrand = brandIds.some(id => 
                    discount.applicableBrands.includes(id)
                );
                if (!hasApplicableBrand) {
                    return { isValid: false, message: '–°–∫–∏–¥–∫–∞ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º–∞ –∫ –≤—ã–±—Ä–∞–Ω–Ω—ã–º –±—Ä–µ–Ω–¥–∞–º' };
                }
            }

            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–∫–∏–¥–∫—É
            let discountAmount = 0;
            switch (discount.type) {
                case DiscountType.PERCENTAGE:
                    discountAmount = (orderAmount * discount.value) / 100;
                    if (discount.maxDiscount && discountAmount > discount.maxDiscount) {
                        discountAmount = discount.maxDiscount;
                    }
                    break;
                case DiscountType.FIXED:
                    discountAmount = discount.value;
                    break;
                case DiscountType.FREE_SHIPPING:
                    discountAmount = 0; // –õ–æ–≥–∏–∫–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
                    break;
            }

            return { isValid: true, discount, discountAmount };
        } catch (error) {
            if (error instanceof NotFoundException) {
                return { isValid: false, message: '–°–∫–∏–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' };
            }
            throw error;
        }
    }

    async applyDiscount(
        discountId: number,
        userId: number,
        orderId: number,
        discountAmount: number,
    ): Promise<DiscountApplicationModel> {
        const discount = await this.findById(discountId);

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        if (discount.usageLimit && discount.usageCount >= discount.usageLimit) {
            throw new BadRequestException('–°–∫–∏–¥–∫–∞ –±–æ–ª—å—à–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∞');
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
        const userUsageCount = await this.discountApplicationModel.count({
            where: { discountId, userId },
        });

        if (userUsageCount >= discount.userLimit) {
            throw new BadRequestException('–í—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —ç—Ç—É —Å–∫–∏–¥–∫—É –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–∑');
        }

        // –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏
        const application = await this.discountApplicationModel.create({
            discountId,
            userId,
            orderId,
            discountAmount,
        });

        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
        await discount.update({
            usageCount: discount.usageCount + 1,
        });

        this.logger.log(`Discount ${discount.name} applied to order ${orderId}`);
        return application;
    }

    async getAutomaticDiscounts(
        orderAmount: number,
        productIds?: number[],
        categoryIds?: number[],
        brandIds?: number[],
    ): Promise<DiscountModel[]> {
        const now = new Date();
        const discounts = await this.discountModel.findAll({
            where: {
                isActive: true,
                isAutomatic: true,
                validFrom: { [Op.lte]: now },
                validTo: { [Op.gte]: now },
                minOrderAmount: { [Op.lte]: orderAmount },
            },
            order: [['priority', 'DESC']],
        });

        // –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏
        return discounts.filter(discount => {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –∫ —Ç–æ–≤–∞—Ä–∞–º
            if (discount.applicableProducts && productIds) {
                const hasApplicableProduct = productIds.some(id => 
                    discount.applicableProducts.includes(id)
                );
                if (!hasApplicableProduct) return false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            if (discount.applicableCategories && categoryIds) {
                const hasApplicableCategory = categoryIds.some(id => 
                    discount.applicableCategories.includes(id)
                );
                if (!hasApplicableCategory) return false;
            }

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –∫ –±—Ä–µ–Ω–¥–∞–º
            if (discount.applicableBrands && brandIds) {
                const hasApplicableBrand = brandIds.some(id => 
                    discount.applicableBrands.includes(id)
                );
                if (!hasApplicableBrand) return false;
            }

            return true;
        });
    }

    async getDiscountUsage(discountId: number): Promise<DiscountApplicationModel[]> {
        return this.discountApplicationModel.findAll({
            where: { discountId },
            include: ['user', 'order'],
            order: [['applied_at', 'DESC']],
        });
    }

    async getActiveDiscounts(): Promise<DiscountModel[]> {
        const now = new Date();
        return this.discountModel.findAll({
            where: {
                isActive: true,
                validFrom: { [Op.lte]: now },
                validTo: { [Op.gte]: now },
            },
            order: [['priority', 'DESC'], ['created_at', 'DESC']],
        });
    }
}
```

## –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã

### Discount Controller
```typescript
// src/infrastructure/controllers/discount.controller.ts
import { Controller, Get, Post, Put, Delete, Param, Body, Query, HttpCode, HttpStatus, UseGuards } from '@nestjs/common';
import { ApiTags, ApiOperation, ApiResponse, ApiQuery, ApiBearerAuth } from '@nestjs/swagger';
import { AuthGuard } from '@app/infrastructure/common/guards/auth.guard';
import { RoleGuard } from '@app/infrastructure/common/guards/role.guard';
import { Roles } from '@app/infrastructure/common/decorators/roles.decorator';
import { CurrentUser } from '@app/infrastructure/common/decorators/current-user.decorator';
import { DiscountService } from '@app/infrastructure/services/discount.service';
import { CreateDiscountDto } from '@app/infrastructure/dto/discount/create-discount.dto';
import { UpdateDiscountDto } from '@app/infrastructure/dto/discount/update-discount.dto';
import { ValidateDiscountDto } from '@app/infrastructure/dto/discount/validate-discount.dto';
import { DiscountResponse, DiscountListResponse } from '@app/infrastructure/responses/discount/discount.response';

@ApiTags('–°–∫–∏–¥–∫–∏')
@Controller('discounts')
export class DiscountController {
    constructor(private readonly discountService: DiscountService) {}

    @Get()
    @HttpCode(HttpStatus.OK)
    @UseGuards(AuthGuard, RoleGuard)
    @Roles('ADMIN')
    @ApiBearerAuth('JWT-auth')
    @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–∫–∏–¥–æ–∫ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)' })
    @ApiQuery({ name: 'page', required: false, description: '–ù–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã' })
    @ApiQuery({ name: 'limit', required: false, description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ' })
    @ApiQuery({ name: 'search', required: false, description: '–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é' })
    @ApiQuery({ name: 'isActive', required: false, description: '–§–∏–ª—å—Ç—Ä –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏' })
    @ApiQuery({ name: 'type', required: false, description: '–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —Å–∫–∏–¥–∫–∏' })
    @ApiResponse({ status: 200, description: '–°–ø–∏—Å–æ–∫ —Å–∫–∏–¥–æ–∫ –ø–æ–ª—É—á–µ–Ω', type: DiscountListResponse })
    async getDiscounts(
        @Query('page') page: number = 1,
        @Query('limit') limit: number = 10,
        @Query('search') search?: string,
        @Query('isActive') isActive?: boolean,
        @Query('type') type?: string,
    ): Promise<DiscountListResponse> {
        const result = await this.discountService.findAll(page, limit, search, isActive, type as any);
        
        return {
            data: result.data.map(discount => ({
                id: discount.id,
                name: discount.name,
                description: discount.description,
                type: discount.type,
                value: discount.value,
                minOrderAmount: discount.minOrderAmount,
                maxDiscount: discount.maxDiscount,
                usageLimit: discount.usageLimit,
                usageCount: discount.usageCount,
                userLimit: discount.userLimit,
                validFrom: discount.validFrom,
                validTo: discount.validTo,
                isActive: discount.isActive,
                isAutomatic: discount.isAutomatic,
                applicableProducts: discount.applicableProducts,
                applicableCategories: discount.applicableCategories,
                applicableBrands: discount.applicableBrands,
                priority: discount.priority,
                createdAt: discount.createdAt,
                updatedAt: discount.updatedAt,
            })),
            meta: {
                totalCount: result.total,
                currentPage: page,
                limit,
                lastPage: Math.ceil(result.total / limit),
                nextPage: page < Math.ceil(result.total / limit) ? page + 1 : null,
                previousPage: page > 1 ? page - 1 : null,
            },
        };
    }

    @Get('active')
    @HttpCode(HttpStatus.OK)
    @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–∫–∏–¥–∫–∏' })
    @ApiResponse({ status: 200, description: '–ê–∫—Ç–∏–≤–Ω—ã–µ —Å–∫–∏–¥–∫–∏ –ø–æ–ª—É—á–µ–Ω—ã', type: [DiscountResponse] })
    async getActiveDiscounts(): Promise<DiscountResponse[]> {
        const discounts = await this.discountService.getActiveDiscounts();
        
        return discounts.map(discount => ({
            id: discount.id,
            name: discount.name,
            description: discount.description,
            type: discount.type,
            value: discount.value,
            minOrderAmount: discount.minOrderAmount,
            maxDiscount: discount.maxDiscount,
            validFrom: discount.validFrom,
            validTo: discount.validTo,
            isAutomatic: discount.isAutomatic,
            priority: discount.priority,
        }));
    }

    @Post('automatic')
    @HttpCode(HttpStatus.OK)
    @UseGuards(AuthGuard)
    @ApiBearerAuth('JWT-auth')
    @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∏–¥–∫–∏ –¥–ª—è –∑–∞–∫–∞–∑–∞' })
    @ApiResponse({ status: 200, description: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∏–¥–∫–∏ –ø–æ–ª—É—á–µ–Ω—ã', type: [DiscountResponse] })
    async getAutomaticDiscounts(
        @Body() validateDiscountDto: ValidateDiscountDto,
    ): Promise<DiscountResponse[]> {
        const discounts = await this.discountService.getAutomaticDiscounts(
            validateDiscountDto.orderAmount,
            validateDiscountDto.productIds,
            validateDiscountDto.categoryIds,
            validateDiscountDto.brandIds,
        );
        
        return discounts.map(discount => ({
            id: discount.id,
            name: discount.name,
            description: discount.description,
            type: discount.type,
            value: discount.value,
            minOrderAmount: discount.minOrderAmount,
            maxDiscount: discount.maxDiscount,
            priority: discount.priority,
        }));
    }

    @Post('validate')
    @HttpCode(HttpStatus.OK)
    @UseGuards(AuthGuard)
    @ApiBearerAuth('JWT-auth')
    @ApiOperation({ summary: '–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Å–∫–∏–¥–∫—É' })
    @ApiResponse({ status: 200, description: '–†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–∫–∏–¥–∫–∏' })
    async validateDiscount(
        @Body() validateDiscountDto: ValidateDiscountDto,
        @CurrentUser() user: any,
    ): Promise<{ isValid: boolean; message?: string; discountAmount?: number }> {
        const result = await this.discountService.validateDiscount(
            validateDiscountDto.discountId,
            user.id,
            validateDiscountDto.orderAmount,
            validateDiscountDto.productIds,
            validateDiscountDto.categoryIds,
            validateDiscountDto.brandIds,
        );

        return {
            isValid: result.isValid,
            message: result.message,
            discountAmount: result.discountAmount,
        };
    }

    @Get(':id')
    @HttpCode(HttpStatus.OK)
    @UseGuards(AuthGuard, RoleGuard)
    @Roles('ADMIN')
    @ApiBearerAuth('JWT-auth')
    @ApiOperation({ summary: '–ü–æ–ª—É—á–∏—Ç—å —Å–∫–∏–¥–∫—É –ø–æ ID (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)' })
    @ApiResponse({ status: 200, description: '–°–∫–∏–¥–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞', type: DiscountResponse })
    @ApiResponse({ status: 404, description: '–°–∫–∏–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' })
    async getDiscountById(@Param('id') id: number): Promise<DiscountResponse> {
        const discount = await this.discountService.findById(id);
        
        return {
            id: discount.id,
            name: discount.name,
            description: discount.description,
            type: discount.type,
            value: discount.value,
            minOrderAmount: discount.minOrderAmount,
            maxDiscount: discount.maxDiscount,
            usageLimit: discount.usageLimit,
            usageCount: discount.usageCount,
            userLimit: discount.userLimit,
            validFrom: discount.validFrom,
            validTo: discount.validTo,
            isActive: discount.isActive,
            isAutomatic: discount.isAutomatic,
            applicableProducts: discount.applicableProducts,
            applicableCategories: discount.applicableCategories,
            applicableBrands: discount.applicableBrands,
            priority: discount.priority,
            createdAt: discount.createdAt,
            updatedAt: discount.updatedAt,
        };
    }

    @Post()
    @HttpCode(HttpStatus.CREATED)
    @UseGuards(AuthGuard, RoleGuard)
    @Roles('ADMIN')
    @ApiBearerAuth('JWT-auth')
    @ApiOperation({ summary: '–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Å–∫–∏–¥–∫—É (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)' })
    @ApiResponse({ status: 201, description: '–°–∫–∏–¥–∫–∞ —Å–æ–∑–¥–∞–Ω–∞', type: DiscountResponse })
    @ApiResponse({ status: 400, description: '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏' })
    async createDiscount(@Body() createDiscountDto: CreateDiscountDto): Promise<DiscountResponse> {
        const discount = await this.discountService.create(createDiscountDto);
        
        return {
            id: discount.id,
            name: discount.name,
            description: discount.description,
            type: discount.type,
            value: discount.value,
            minOrderAmount: discount.minOrderAmount,
            maxDiscount: discount.maxDiscount,
            usageLimit: discount.usageLimit,
            usageCount: discount.usageCount,
            userLimit: discount.userLimit,
            validFrom: discount.validFrom,
            validTo: discount.validTo,
            isActive: discount.isActive,
            isAutomatic: discount.isAutomatic,
            applicableProducts: discount.applicableProducts,
            applicableCategories: discount.applicableCategories,
            applicableBrands: discount.applicableBrands,
            priority: discount.priority,
            createdAt: discount.createdAt,
            updatedAt: discount.updatedAt,
        };
    }

    @Put(':id')
    @HttpCode(HttpStatus.OK)
    @UseGuards(AuthGuard, RoleGuard)
    @Roles('ADMIN')
    @ApiBearerAuth('JWT-auth')
    @ApiOperation({ summary: '–û–±–Ω–æ–≤–∏—Ç—å —Å–∫–∏–¥–∫—É (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)' })
    @ApiResponse({ status: 200, description: '–°–∫–∏–¥–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞', type: DiscountResponse })
    @ApiResponse({ status: 404, description: '–°–∫–∏–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' })
    @ApiResponse({ status: 400, description: '–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏' })
    async updateDiscount(
        @Param('id') id: number,
        @Body() updateDiscountDto: UpdateDiscountDto,
    ): Promise<DiscountResponse> {
        const discount = await this.discountService.update(id, updateDiscountDto);
        
        return {
            id: discount.id,
            name: discount.name,
            description: discount.description,
            type: discount.type,
            value: discount.value,
            minOrderAmount: discount.minOrderAmount,
            maxDiscount: discount.maxDiscount,
            usageLimit: discount.usageLimit,
            usageCount: discount.usageCount,
            userLimit: discount.userLimit,
            validFrom: discount.validFrom,
            validTo: discount.validTo,
            isActive: discount.isActive,
            isAutomatic: discount.isAutomatic,
            applicableProducts: discount.applicableProducts,
            applicableCategories: discount.applicableCategories,
            applicableBrands: discount.applicableBrands,
            priority: discount.priority,
            createdAt: discount.createdAt,
            updatedAt: discount.updatedAt,
        };
    }

    @Delete(':id')
    @HttpCode(HttpStatus.NO_CONTENT)
    @UseGuards(AuthGuard, RoleGuard)
    @Roles('ADMIN')
    @ApiBearerAuth('JWT-auth')
    @ApiOperation({ summary: '–£–¥–∞–ª–∏—Ç—å —Å–∫–∏–¥–∫—É (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)' })
    @ApiResponse({ status: 204, description: '–°–∫–∏–¥–∫–∞ —É–¥–∞–ª–µ–Ω–∞' })
    @ApiResponse({ status: 404, description: '–°–∫–∏–¥–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' })
    @ApiResponse({ status: 400, description: '–ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Å–∫–∏–¥–∫—É, –∫–æ—Ç–æ—Ä–∞—è —É–∂–µ –ø—Ä–∏–º–µ–Ω—è–ª–∞—Å—å' })
    async deleteDiscount(@Param('id') id: number): Promise<void> {
        return this.discountService.delete(id);
    }
}
```

## –ú–∏–≥—Ä–∞—Ü–∏–∏

### –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å–∫–∏–¥–æ–∫
```typescript
// db/migrations/YYYYMMDDHHMMSS-create-discount-system.ts
import { QueryInterface, DataTypes } from 'sequelize';

export async function up(queryInterface: QueryInterface): Promise<void> {
    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã discounts
    await queryInterface.createTable('discounts', {
        id: {
            type: DataTypes.INTEGER,
            primaryKey: true,
            autoIncrement: true,
        },
        name: {
            type: DataTypes.STRING(100),
            allowNull: false,
        },
        description: {
            type: DataTypes.TEXT,
            allowNull: true,
        },
        type: {
            type: DataTypes.ENUM('percentage', 'fixed', 'free_shipping'),
            allowNull: false,
        },
        value: {
            type: DataTypes.DECIMAL(10, 2),
            allowNull: false,
        },
        min_order_amount: {
            type: DataTypes.DECIMAL(10, 2),
            allowNull: false,
            defaultValue: 0.00,
        },
        max_discount: {
            type: DataTypes.DECIMAL(10, 2),
            allowNull: true,
        },
        usage_limit: {
            type: DataTypes.INTEGER,
            allowNull: true,
        },
        usage_count: {
            type: DataTypes.INTEGER,
            allowNull: false,
            defaultValue: 0,
        },
        user_limit: {
            type: DataTypes.INTEGER,
            allowNull: false,
            defaultValue: 1,
        },
        valid_from: {
            type: DataTypes.DATE,
            allowNull: false,
        },
        valid_to: {
            type: DataTypes.DATE,
            allowNull: false,
        },
        is_active: {
            type: DataTypes.BOOLEAN,
            allowNull: false,
            defaultValue: true,
        },
        is_automatic: {
            type: DataTypes.BOOLEAN,
            allowNull: false,
            defaultValue: false,
        },
        applicable_products: {
            type: DataTypes.ARRAY(DataTypes.INTEGER),
            allowNull: true,
        },
        applicable_categories: {
            type: DataTypes.ARRAY(DataTypes.INTEGER),
            allowNull: true,
        },
        applicable_brands: {
            type: DataTypes.ARRAY(DataTypes.INTEGER),
            allowNull: true,
        },
        priority: {
            type: DataTypes.INTEGER,
            allowNull: false,
            defaultValue: 0,
        },
        created_at: {
            type: DataTypes.DATE,
            allowNull: false,
            defaultValue: DataTypes.NOW,
        },
        updated_at: {
            type: DataTypes.DATE,
            allowNull: false,
            defaultValue: DataTypes.NOW,
        },
    });

    // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã discount_applications
    await queryInterface.createTable('discount_applications', {
        id: {
            type: DataTypes.INTEGER,
            primaryKey: true,
            autoIncrement: true,
        },
        discount_id: {
            type: DataTypes.INTEGER,
            allowNull: false,
            references: { model: 'discounts', key: 'id' },
            onDelete: 'CASCADE',
        },
        user_id: {
            type: DataTypes.INTEGER,
            allowNull: false,
            references: { model: 'users', key: 'id' },
            onDelete: 'CASCADE',
        },
        order_id: {
            type: DataTypes.INTEGER,
            allowNull: false,
            references: { model: 'orders', key: 'id' },
            onDelete: 'CASCADE',
        },
        discount_amount: {
            type: DataTypes.DECIMAL(10, 2),
            allowNull: false,
        },
        applied_at: {
            type: DataTypes.DATE,
            allowNull: false,
            defaultValue: DataTypes.NOW,
        },
    });

    // –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
    await queryInterface.addIndex('discounts', ['type']);
    await queryInterface.addIndex('discounts', ['is_active']);
    await queryInterface.addIndex('discounts', ['is_automatic']);
    await queryInterface.addIndex('discounts', ['valid_from', 'valid_to']);
    await queryInterface.addIndex('discounts', ['priority']);

    await queryInterface.addIndex('discount_applications', ['discount_id']);
    await queryInterface.addIndex('discount_applications', ['user_id']);
    await queryInterface.addIndex('discount_applications', ['order_id']);
    await queryInterface.addIndex('discount_applications', ['applied_at']);
}

export async function down(queryInterface: QueryInterface): Promise<void> {
    await queryInterface.dropTable('discount_applications');
    await queryInterface.dropTable('discounts');
}
```

## DTO –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

### CreateDiscountDto
```typescript
// src/infrastructure/dto/discount/create-discount.dto.ts
import { IsString, IsEnum, IsNumber, IsBoolean, IsOptional, IsArray, IsDateString, Length, Min } from 'class-validator';
import { DiscountType } from '@app/domain/models/discount.model';

export class CreateDiscountDto {
    @IsString({ message: '–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∏–¥–∫–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π' })
    @Length(1, 100, { message: '–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∏–¥–∫–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç 1 –¥–æ 100 —Å–∏–º–≤–æ–ª–æ–≤' })
    declare readonly name: string;

    @IsOptional()
    @IsString({ message: '–û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π' })
    declare readonly description?: string;

    @IsEnum(DiscountType, { message: '–¢–∏–ø —Å–∫–∏–¥–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–Ω–∏–º –∏–∑: percentage, fixed, free_shipping' })
    declare readonly type: DiscountType;

    @IsNumber({}, { message: '–ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    @Min(0, { message: '–ó–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º' })
    declare readonly value: number;

    @IsOptional()
    @IsNumber({}, { message: '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    @Min(0, { message: '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π' })
    declare readonly minOrderAmount?: number;

    @IsOptional()
    @IsNumber({}, { message: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    @Min(0, { message: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π' })
    declare readonly maxDiscount?: number;

    @IsOptional()
    @IsNumber({}, { message: '–õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    @Min(1, { message: '–õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 0' })
    declare readonly usageLimit?: number;

    @IsOptional()
    @IsNumber({}, { message: '–õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    @Min(1, { message: '–õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 0' })
    declare readonly userLimit?: number;

    @IsDateString({}, { message: '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω–æ–π –¥–∞—Ç–æ–π' })
    declare readonly validFrom: string;

    @IsDateString({}, { message: '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∞–ª–∏–¥–Ω–æ–π –¥–∞—Ç–æ–π' })
    declare readonly validTo: string;

    @IsOptional()
    @IsBoolean({ message: '–°—Ç–∞—Ç—É—Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±—É–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º' })
    declare readonly isActive?: boolean;

    @IsOptional()
    @IsBoolean({ message: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±—É–ª–µ–≤—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º' })
    declare readonly isAutomatic?: boolean;

    @IsOptional()
    @IsArray({ message: '–ü—Ä–∏–º–µ–Ω–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º' })
    @IsNumber({}, { each: true, message: 'ID —Ç–æ–≤–∞—Ä–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    declare readonly applicableProducts?: number[];

    @IsOptional()
    @IsArray({ message: '–ü—Ä–∏–º–µ–Ω–∏–º—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º' })
    @IsNumber({}, { each: true, message: 'ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    declare readonly applicableCategories?: number[];

    @IsOptional()
    @IsArray({ message: '–ü—Ä–∏–º–µ–Ω–∏–º—ã–µ –±—Ä–µ–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º' })
    @IsNumber({}, { each: true, message: 'ID –±—Ä–µ–Ω–¥–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    declare readonly applicableBrands?: number[];

    @IsOptional()
    @IsNumber({}, { message: '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    declare readonly priority?: number;
}
```

### UpdateDiscountDto
```typescript
// src/infrastructure/dto/discount/update-discount.dto.ts
import { PartialType } from '@nestjs/swagger';
import { CreateDiscountDto } from './create-discount.dto';

export class UpdateDiscountDto extends PartialType(CreateDiscountDto) {}
```

### ValidateDiscountDto
```typescript
// src/infrastructure/dto/discount/validate-discount.dto.ts
import { IsNumber, IsOptional, IsArray, Min } from 'class-validator';

export class ValidateDiscountDto {
    @IsOptional()
    @IsNumber({}, { message: 'ID —Å–∫–∏–¥–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    @Min(1, { message: 'ID —Å–∫–∏–¥–∫–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 0' })
    declare readonly discountId?: number;

    @IsNumber({}, { message: '–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    @Min(0, { message: '–°—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π' })
    declare readonly orderAmount: number;

    @IsOptional()
    @IsArray({ message: 'ID —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º' })
    @IsNumber({}, { each: true, message: 'ID —Ç–æ–≤–∞—Ä–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    declare readonly productIds?: number[];

    @IsOptional()
    @IsArray({ message: 'ID –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º' })
    @IsNumber({}, { each: true, message: 'ID –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    declare readonly categoryIds?: number[];

    @IsOptional()
    @IsArray({ message: 'ID –±—Ä–µ–Ω–¥–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º' })
    @IsNumber({}, { each: true, message: 'ID –±—Ä–µ–Ω–¥–∞ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º' })
    declare readonly brandIds?: number[];
}
```

## Response –∫–ª–∞—Å—Å—ã

### DiscountResponse
```typescript
// src/infrastructure/responses/discount/discount.response.ts
import { ApiProperty } from '@nestjs/swagger';
import { DiscountType } from '@app/domain/models/discount.model';

export class DiscountResponse {
    @ApiProperty({ description: 'ID —Å–∫–∏–¥–∫–∏' })
    declare readonly id: number;

    @ApiProperty({ description: '–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∫–∏–¥–∫–∏' })
    declare readonly name: string;

    @ApiProperty({ description: '–û–ø–∏—Å–∞–Ω–∏–µ —Å–∫–∏–¥–∫–∏', required: false })
    declare readonly description?: string;

    @ApiProperty({ description: '–¢–∏–ø —Å–∫–∏–¥–∫–∏', enum: DiscountType })
    declare readonly type: DiscountType;

    @ApiProperty({ description: '–ó–Ω–∞—á–µ–Ω–∏–µ —Å–∫–∏–¥–∫–∏' })
    declare readonly value: number;

    @ApiProperty({ description: '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞' })
    declare readonly minOrderAmount: number;

    @ApiProperty({ description: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞', required: false })
    declare readonly maxDiscount?: number;

    @ApiProperty({ description: '–õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è', required: false })
    declare readonly usageLimit?: number;

    @ApiProperty({ description: '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π' })
    declare readonly usageCount: number;

    @ApiProperty({ description: '–õ–∏–º–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º' })
    declare readonly userLimit: number;

    @ApiProperty({ description: '–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è' })
    declare readonly validFrom: Date;

    @ApiProperty({ description: '–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è' })
    declare readonly validTo: Date;

    @ApiProperty({ description: '–ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ —Å–∫–∏–¥–∫–∞' })
    declare readonly isActive: boolean;

    @ApiProperty({ description: '–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ' })
    declare readonly isAutomatic: boolean;

    @ApiProperty({ description: '–ü—Ä–∏–º–µ–Ω–∏–º—ã–µ —Ç–æ–≤–∞—Ä—ã', required: false })
    declare readonly applicableProducts?: number[];

    @ApiProperty({ description: '–ü—Ä–∏–º–µ–Ω–∏–º—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏', required: false })
    declare readonly applicableCategories?: number[];

    @ApiProperty({ description: '–ü—Ä–∏–º–µ–Ω–∏–º—ã–µ –±—Ä–µ–Ω–¥—ã', required: false })
    declare readonly applicableBrands?: number[];

    @ApiProperty({ description: '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç —Å–∫–∏–¥–∫–∏' })
    declare readonly priority: number;

    @ApiProperty({ description: '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è' })
    declare readonly createdAt: Date;

    @ApiProperty({ description: '–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è' })
    declare readonly updatedAt: Date;
}

export class DiscountListResponse {
    @ApiProperty({ description: '–°–ø–∏—Å–æ–∫ —Å–∫–∏–¥–æ–∫', type: [DiscountResponse] })
    declare readonly data: DiscountResponse[];

    @ApiProperty({ description: '–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏' })
    declare readonly meta: {
        totalCount: number;
        currentPage: number;
        limit: number;
        lastPage: number;
        nextPage: number | null;
        previousPage: number | null;
    };
}
```

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- [ ] –°–æ–∑–¥–∞–Ω—ã –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü discounts –∏ discount_applications
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–æ–¥–µ–ª–∏ Sequelize (DiscountModel, DiscountApplicationModel)
- [ ] –°–æ–∑–¥–∞–Ω DiscountService —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Å–∫–∏–¥–æ–∫
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω DiscountController —Å API endpoints
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã DTO –∫–ª–∞—Å—Å—ã —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [ ] –°–æ–∑–¥–∞–Ω—ã Response –∫–ª–∞—Å—Å—ã —Å Swagger
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–∫–∏–¥–æ–∫
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã unit —Ç–µ—Å—Ç—ã –¥–ª—è DiscountService
- [ ] –î–æ–±–∞–≤–ª–µ–Ω—ã integration —Ç–µ—Å—Ç—ã –¥–ª—è API
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –∑–∞–∫–∞–∑–æ–≤

### üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- [ ] –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–∫–∏–¥–æ–∫
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∏–¥–∫–∏
- [ ] –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
- [ ] –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å–∫–∏–¥–æ–∫
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (1 –Ω–µ–¥–µ–ª—è)
1. **–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏** –¥–ª—è —Ç–∞–±–ª–∏—Ü discounts –∏ discount_applications
2. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–¥–µ–ª–∏** Sequelize
3. **–°–æ–∑–¥–∞—Ç—å DTO –∫–ª–∞—Å—Å—ã** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
4. **–°–æ–∑–¥–∞—Ç—å Response –∫–ª–∞—Å—Å—ã** —Å Swagger
5. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DiscountService** —Å –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–æ–π

### –§–∞–∑–∞ 2: API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (3-4 –¥–Ω—è)
6. **–°–æ–∑–¥–∞—Ç—å DiscountController** —Å API endpoints
7. **–î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å–∫–∏–¥–æ–∫** –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤
8. **–ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –∫–æ—Ä–∑–∏–Ω–æ–π** –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Å–∫–∏–¥–æ–∫
9. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∏–¥–∫–∏**

### –§–∞–∑–∞ 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–∞—á–µ—Å—Ç–≤–æ (2-3 –¥–Ω—è)
10. **–ù–∞–ø–∏—Å–∞—Ç—å unit —Ç–µ—Å—Ç—ã** –¥–ª—è DiscountService
11. **–ù–∞–ø–∏—Å–∞—Ç—å integration —Ç–µ—Å—Ç—ã** –¥–ª—è API
12. **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫** –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é
13. **–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥** –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é

## –†–∏—Å–∫–∏ –∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

### ‚ö†Ô∏è –†–∏—Å–∫–∏:
- **–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏**: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å–∫–∏–¥–æ–∫
- **–ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ**: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∫–∏–¥–æ–∫ –Ω–µ –ø–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—é
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### üîÑ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: Redis –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–∫–∏–¥–æ–∫
- **–í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã**: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞–º–∏ —Å–∫–∏–¥–æ–∫
- **–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**: —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ —Å–∫–∏–¥–∫–∏ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã:
- **OrderService** - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å–∫–∏–¥–æ–∫ –∫ –∑–∞–∫–∞–∑–∞–º
- **CartService** - –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–∫–∏–¥–æ–∫ –≤ –∫–æ—Ä–∑–∏–Ω–µ
- **UserService** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- **ProductService** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ –∫ —Ç–æ–≤–∞—Ä–∞–º
- **CategoryService** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- **BrandService** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç–∏ –∫ –±—Ä–µ–Ω–¥–∞–º

### üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞:
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Å–∫–∏–¥–∫–∏
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–∫–∏–¥–æ–∫
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

## TL;DR

–£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫ –≤–∫–ª—é—á–∞–µ—Ç:
- **2 —Ç–∞–±–ª–∏—Ü—ã**: discounts, discount_applications
- **2 –º–æ–¥–µ–ª–∏**: DiscountModel, DiscountApplicationModel
- **1 —Å–µ—Ä–≤–∏—Å**: DiscountService —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
- **1 –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä**: API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∫–∏–¥–∫–∞–º–∏
- **–§—É–Ω–∫—Ü–∏–∏**: –ø—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ/—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∫–∏–¥–∫–∏, –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ø–æ –≤—Ä–µ–º–µ–Ω–∏, –ª–∏–º–∏—Ç–∞–º, —Ç–æ–≤–∞—Ä–∞–º, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º, –±—Ä–µ–Ω–¥–∞–º
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∏–¥–∫–∏**: —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ –∏ —É—Å–ª–æ–≤–∏—è–º–∏
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º